<?php
function mycrawler($url, $cookie="none", $timeout=10)
{
	$urlinfo = parse_url($url);		
						 
	if (empty($urlinfo['scheme'])) {$urlinfo = parse_url('http://'.$url);}                                                                 
	if (empty($urlinfo["path"])) {$urlinfo["path"]="/";}
				 
	if (empty($urlinfo['port']))
	{
		switch($urlinfo['scheme'])
		{
			case "http":
				$urlinfo['port'] = 80;
				break; 
			case "https":
				$urlinfo['port'] = 443;
				break;               
		}
	}
	
	if (isset($urlinfo["query"]))
	{
		$request = "GET ".$urlinfo["path"]."?".$urlinfo["query"]." ";
	} else {   
		$request = "GET ".$urlinfo["path"]." ";
	}
   
	$request .= "HTTP/1.0\r\n";
	$request .= "Host: ".$urlinfo['host']."\r\n";
	$request .= "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.4) Gecko/20100611 Firefox/3.6.4" ."\r\n";
	$request .= "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" ."\r\n";
	$request .= "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7" ."\r\n";
	if ($cookie != "none") $request .= "Cookie: ".$cookie."\r\n\r\n";
	$request .= "Connection: close\r\n\r\n";
	
	//echo $request;
	$fp = fsockopen($urlinfo['host'], $urlinfo['port'], $errno, $errstr, $timeout);
	if (!$fp)
	{
		echo "(".$errno.")".$errstr."\n";           
	}
	else
	{   
		fwrite($fp, $request);
		stream_set_timeout($fp, 30);
		$data = "";
		while (!feof($fp))
		{
			$data .= fgets($fp, 4096);                     
			$info = stream_get_meta_data($fp);
			if ($info['timed_out']) 
			{
				fclose($fp); 
				return "";
			}
		}
		
		fclose($fp); 
		
		$tmp = explode("\r\n\r\n", $data, 2);
		return $tmp[1];        
	}       
}

function delUntilMeet($inputStr, $meetString)
{
	$pos = strpos($inputStr, $meetString);
	if ($pos===false) return false;
	return substr($inputStr, $pos + strlen($meetString));
}
function getUntilMeet($inputStr, $meetString)
{
	$pos = strpos($inputStr, $meetString);
	if ($pos===false) return false;
	return substr($inputStr, 0, $pos);
}
		
function getBetween($content,$start,$end){
    $r = explode($start, $content);
    if (isset($r[1])){
        $r = explode($end, $r[1]);
        return $r[0];
    }
    return '';
}

function getRandomNumbers($numbers, $quantity) {
    shuffle($numbers);
    return array_slice($numbers, 0, $quantity);
}

function getRootDomain($url) {
    $tmp = explode(".", $url);
	if(count($tmp) < 2) return false;
    $domain = $tmp[count($tmp)-2] . "." . $tmp[count($tmp)-1]; 
	return str_replace("/", "", $domain);
}

?>